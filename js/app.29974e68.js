(function(e){function t(t){for(var n,c,s=t[0],a=t[1],l=t[2],u=0,f=[];u<s.length;u++)c=s[u],Object.prototype.hasOwnProperty.call(i,c)&&i[c]&&f.push(i[c][0]),i[c]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);d&&d(t);while(f.length)f.shift()();return r.push.apply(r,l||[]),o()}function o(){for(var e,t=0;t<r.length;t++){for(var o=r[t],n=!0,s=1;s<o.length;s++){var a=o[s];0!==i[a]&&(n=!1)}n&&(r.splice(t--,1),e=c(c.s=o[0]))}return e}var n={},i={app:0},r=[];function c(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,c),o.l=!0,o.exports}c.m=e,c.c=n,c.d=function(e,t,o){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(c.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(o,n,function(t){return e[t]}.bind(null,n));return o},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/cordova-webrtc/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],a=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=a;r.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"0806":function(e,t,o){"use strict";o("f96c")},1:function(e,t){},"56d7":function(e,t,o){"use strict";o.r(t);o("e260"),o("e6cf"),o("cca6"),o("a79d");var n=o("2b0e"),i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[e._m(0),o("h1",[e._v("Kaissa WebChat")]),o("div",[e.mobile?e._e():o("div",[o("video",{staticClass:"browservid",attrs:{id:"yourVideo",autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),o("video",{staticClass:"browservid",attrs:{id:"friendsVideo",autoplay:"",playsinline:""}})]),e.mobile?o("div",[o("video",{staticClass:"mobilevid",attrs:{id:"yourVideo",autoplay:"",muted:"",playsinline:""},domProps:{muted:!0}}),o("video",{staticClass:"mobilevid",attrs:{id:"friendsVideo",autoplay:"",playsinline:""}})]):e._e(),o("br"),e.callActive?o("button",{on:{click:e.disconnectCall}},[e._v("Disconnect")]):e._e(),o("br"),o("br"),o("p",{staticStyle:{color:"rgb(89, 178, 17)"}},[o("b",[e._v(" Your ID : "),o("span",{staticStyle:{color:"rgb(10,10,10)"}},[e._v(e._s(e.yourId))])])]),e.caller?o("p",[o("b",[e._v(" You are connected to "),o("span",{staticStyle:{color:"rgb(141, 16, 224)"}},[o("i",[e._v(e._s(e.returnReceiver))])])])]):e._e(),e.callActive?e._e():o("div",[o("h2",[e._v("Contact List")]),o("br"),e._l(e.returnUsers,(function(t,n){return o("div",{key:n},[t.doc._id!=e.yourId&&"online"==t.doc.status?o("div",[o("span",{staticClass:"user"},[e._v(e._s(t.doc._id))]),o("button",{staticClass:"call",on:{click:function(o){return e.callUser(t.doc._id)}}},[e._v("Call")]),"online"==t.doc.status?o("span",{staticClass:"dot"}):e._e()]):e._e(),o("br")])}))],2)]),e._m(1),o("br"),e._m(2)])},r=[function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"nav"}},[e._v(" Created by "),o("b",[e._v("Pranjalya Tiwari")])])},function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"about"},[o("h3",[e._v("How to Use")]),o("p",[e._v("Login with your unique ids that you enter at the time of loading, so others can identify you.")]),o("p",[e._v("Due to unavailabilty of Sockets in this particular server, try to enter same name, so as to avoid confusion.")]),o("p",[e._v("Locate your friend's id, and place a call.")])])},function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"about"},[o("h3",[e._v("About")]),o("p",[e._v(" You like it? It's available here! "),o("a",{attrs:{href:"https://www.github.com/Pranjalya/cordova-webrtc"}},[e._v("Github")])]),o("p",[e._v("It's unique because no relay mechanism has been used, as it is based on completely serverless architecture and caters a P2P connection.")]),o("p",[e._v(" Want to know something more awesome? You both are connected to each other, directly! As you should be "),o("span",{attrs:{id:"smilee"}},[o("b",[e._v(";P")])])]),o("p",[e._v("If it's laggy, it's better the second time around. Try reloading it.")]),o("p",[e._v("Viewing online candidates service can be run locally, but can't be run on net as of now, due to Socket hosting requirements.")]),o("p",[e._v("Hope you enjoy it!")])])}],c=(o("c975"),o("16b2").default);document.addEventListener("deviceready",(function(){console.log("cordova.plugins.CordovaCall is now available")}));var s={data:function(){return{localDB:{},remoteDB:{},contacts:{},pc:{},yourVideo:{},friendsVideo:{},yourId:"",servers:{},activeUsers:[],receiversId:"",callActive:!1,displayCaller:!1,calling:!1,caller:!1,mobile:!1}},mounted:function(){var e=this;this.localDB=new c("localDB"),this.remoteDB=new c("https://4f241480-c3c9-41c6-bb2e-98fd4cfe269e-bluemix:2d0f75eae437887122aec87b1225ad19a294f459beeb0a20fd69fb333cee4d4a@4f241480-c3c9-41c6-bb2e-98fd4cfe269e-bluemix.cloudantnosqldb.appdomain.cloud/webrtc"),this.startRep(),this.yourVideo=document.getElementById("yourVideo"),this.friendsVideo=document.getElementById("friendsVideo"),console.log("My ID : ",this.yourId),this.contacts.get(this.yourId).then((function(t){e.conatcts.put({_id:e.yourId,status:"online",_rev:t._rev})})).catch((function(t){404==t.status&&e.contacts.put({_id:e.yourId,status:"online"}).then((function(){console.log("User added.")})).catch((function(e){console.log("User not added",e)}))})),this.contacts.allDocs({include_docs:!0,attachments:!0}).then((function(t){e.activeUsers=t.rows})).catch((function(e){console.log(e)})),this.servers={iceServers:[{urls:"stun:stun.services.mozilla.com"},{urls:"stun:stun.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"kingkiller",username:"pranjalyawarrior@gmail.com"}]},this.receiversId=this.returnReceiver,this.pc=new RTCPeerConnection(this.servers),this.pc.onicecandidate=function(t){return t.candidate?e.sendMessage(e.yourId,e.returnReceiver,JSON.stringify({ice:t.candidate})):e.callActive=!0},this.pc.onaddstream=function(e){return friendsVideo.srcObject=e.stream},this.changesMonitor()},created:function(){this.mobile=this.isMobile(),console.log("This is mobile screen : ",this.mobile),this.yourId=prompt("Enter your ID"),this.contacts=new c("https://4f241480-c3c9-41c6-bb2e-98fd4cfe269e-bluemix:2d0f75eae437887122aec87b1225ad19a294f459beeb0a20fd69fb333cee4d4a@4f241480-c3c9-41c6-bb2e-98fd4cfe269e-bluemix.cloudantnosqldb.appdomain.cloud/rtcusers"),this.showMyFace()},computed:{returnUsers:function(){return this.activeUsers},returnReceiver:function(){return this.$store.getters.receiver}},methods:{showMyFace:function(){var e=this;navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0}).then((function(t){return e.yourVideo.srcObject=t})).then((function(t){return e.pc.addStream(t)})).catch(console.log)},showFriendsFace:function(){var e=this;this.pc.createOffer().then((function(t){return e.pc.setLocalDescription(t)})).then((function(){return e.sendMessage(e.yourId,e.returnReceiver,JSON.stringify({sdp:e.pc.localDescription}))}))},sendMessage:function(e,t,o){console.log("Sending message",this.yourId),this.localDB.post({sender:e,receiver:t,message:o}).then((function(e){console.log(e)})).catch((function(e){return console.log(e)}))},readMessage:function(e){var t=this;console.log("Reading message with data",e);var o=JSON.parse(e.doc.message),n=e.doc.sender,i=e.doc.receiver;console.log("Sender: ",n,"My ID: ",this.yourId,"Receiver = ",i),n!=this.yourId&&(o.closeConnection?(navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0},(function(e){t.pc.removeStream(e)})),this.friendsVideo.srcObject=null,this.callActive=!1,this.callActive||document.location.reload()):void 0!=o.ice?(this.pc.addIceCandidate(new RTCIceCandidate(o.ice)).catch((function(e){return console.log(e)})),console.log("ICE candidate added")):"offer"==o.sdp.type?(console.log("Offer recieved"),this.pc.setRemoteDescription(new RTCSessionDescription(o.sdp)).then((function(){return t.pc.createAnswer()})).then((function(e){return t.pc.setLocalDescription(e)})).then((function(){return t.sendMessage(t.yourId,t.returnReceiver,JSON.stringify({sdp:t.pc.localDescription}))})).catch((function(e){console.log(e)}))):"answer"==o.sdp.type&&(this.pc.setRemoteDescription(new RTCSessionDescription(o.sdp)),console.log("Answer received"),this.calling=!0,this.callActive=!0),this.displayCaller=!0)},startRep:function(){console.log("Replication started"),c.replicate("localDB",this.remoteDB,{live:!0,retry:!0}).on("change",(function(e){})).on("paused",(function(e){console.log("Replication: paused",e)})).on("active",(function(){console.log("Replication: active")})).on("denied",(function(e){console.log("Replication: denied",e)})).on("complete",(function(e){console.log("Replication: complete",e)})).on("error",(function(e){console.log("Replication: change",e)}))},callUser:function(e){this.caller=!0,console.log("Calling user with ",e),this.$store.dispatch("updateReceiver",e),console.log("R = ",this.returnReceiver),this.showFriendsFace()},disconnectCall:function(){var e=this;this.sendMessage(this.yourId,this.returnReceiver,JSON.stringify({closeConnection:!0})),setTimeout((function(){return document.location.reload()}),1500),navigator.mediaDevices.getDisplayMedia({audio:!0,video:!0},(function(t){e.pc.removeStream(t)})),this.friendsVideo.srcObject=null,this.callActive=!1,this.$store.dispatch("updateReceiver","")},changesMonitor:function(){var e=this;console.log("Change Monitor started"),this.remoteDB.changes({since:"now",live:!0,include_docs:!0}).on("change",(function(t){console.log(t.doc,e.returnReceiver),(t.doc.sender==e.returnReceiver||t.doc.receiver==e.yourId&&t.doc.sender!=e.yourId)&&e.readMessage(t)})).on("error",(function(e){console.log("Change error",err)}));this.contacts.changes({since:"now",live:!0,include_docs:!0}).on("change",(function(t){e.contacts.allDocs({include_docs:!0,attachments:!0}).then((function(t){e.activeUsers=t.rows})).catch((function(e){console.log(e)}))}))},isMobile:function(){return"undefined"!==typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}}},a=s,l=(o("0806"),o("2877")),d=Object(l["a"])(a,i,r,!1,null,"3830b25d",null),u=d.exports,f=o("8c4f");n["a"].use(f["a"]);var v=[],p=new f["a"]({mode:"history",base:"/cordova-webrtc/",routes:v}),h=p,g=o("2f62");n["a"].use(g["a"]);var b=new g["a"].Store({getters:{receiver:function(e){return e.receiver}},state:{receiver:""},mutations:{updateReceiver:function(e,t){return console.log("committing mutation on name = ",t),e.receiver=t,e.receiver}},actions:{updateReceiver:function(e,t){console.log("Commiting updateReceiver with name = ",t),e.commit("updateReceiver",t)}},modules:{}}),m=o("9483");Object(m["a"])("".concat("/cordova-webrtc/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),n["a"].config.productionTip=!1,new n["a"]({router:h,store:b,render:function(e){return e(u)}}).$mount("#app")},f96c:function(e,t,o){}});
//# sourceMappingURL=app.29974e68.js.map